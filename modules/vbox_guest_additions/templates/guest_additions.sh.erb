#!/bin/bash

function cleanup() {
    umount /mnt

    # No point in running this script again, even if it failed (why would it
    # pass the next time?)
    mv "<%= @installer_dst %>" "<%= @installer_dst %>.ran"
}

trap cleanup EXIT

# Mount the Virtualbox guest additions ISO
mount -o loop,ro "<%= @vbox_guest_additions_dst %>" /mnt || exit 1

# Install the guest additions kernel module
echo yes | /mnt/VBoxLinuxAdditions.run
